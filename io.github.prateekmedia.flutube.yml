app-id: io.github.prateekmedia.flutube
runtime: org.gnome.Platform
runtime-version: "41"
sdk: org.gnome.Sdk
rename-icon: flutube
rename-appdata-file: flutube.appdata.xml
rename-desktop-file: flutube.desktop
command: flutube
separate-locales: false
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --share=network
  - --device=dri
  - --filesystem=xdg-download
  - --talk-name=org.freedesktop.Notifications
modules:
  - name: intltool
    cleanup:
       - '*'
    sources:
       - type: archive
         url: https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz
         sha256: 67c74d94196b153b774ab9f89b2fa6c6ba79352407037c8c14d5aeb334e959cd

  - name: libndp
    buildsystem: autotools
    sources:
      - type: archive
        url: ' http://libndp.org/files/libndp-1.6.tar.gz'
        sha256: 0c7dfa84e013bd5e569ef2c6292a6f72cfaf14f4ff77a77425e52edc33ffac0e

  - name: NetworkManager
    buildsystem: meson
    build-options:
      cflags: -ltinfo
      cxxflags: -ltinfo
    config-opts:
      - -Dlibaudit=no
      - -Ddbus_conf_dir=/app/etc/dbus-1/system.d
      - -Ddbus_ifaces_dir=/app/share/dbus-1/interfaces
      - -Ddbus_sys_dir=/app/share/dbus-1/system.d
      - -Ddnsmasq=/usr/bin/true
      - -Ddocs=false
      - -Dintrospection=false
      - -Diptables=/usr/bin/true
      - -Djson_validation=false
      - -Dlibnm_glib=false
      - -Dlibpsl=false
      - -Dmodem_manager=false
      - -Dnmtui=false
      - -Dovs=false
      - -Dppp=false
      - -Dqt=false
      - -Dselinux=false
      - -Dsession_tracking=no
      - -Dsystemdsystemunitdir=no
      - -Dsystemd_journal=false
      - -Dtests=no
      - -Dvapi=false
    sources:
      - type: git
        url: 'https://gitlab.freedesktop.org/NetworkManager/NetworkManager.git'
        tag: "1.32.12"

  - name: flutube
    buildsystem: simple
    build-commands:
      - cp -R flutube/usr/bin/ /app/flutube
      - cp -R flutube/usr/share/ /app/share
      - sed -i 's/<id>flutube/<id>io.github.prateekmedia.flutube/' /app/share/metainfo/flutube.appdata.xml
      - mkdir -p /app/bin/
      - ln -s /app/flutube/flutube /app/bin/flutube
    sources:
      - type: archive
        only-arches:
          - x86_64
        url: https://github.com/prateekmedia/flutube/releases/download/0.5.0/flutube-linux-x86_64.tar.gz
        dest: flutube
        sha256: e040a98f1612a25a65ffa507c568c8f1599dea9633afc796c63ab95f47031bdd
        x-checker-data:
          type: json
          url: https://api.github.com/repos/prateekmedia/flutube/releases/latest
          version-query: .tag_name
          url-query: .assets[]  | select(.name=="flutube-linux-x86_64.tar.gz") | .browser_download_url
